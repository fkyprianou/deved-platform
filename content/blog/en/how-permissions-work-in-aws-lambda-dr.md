---
title: How Permissions Work in AWS Lambda
description: A general breakdown of how AWS Lambda function permissions work,
  granting access to other AWS services, without the need of using AWS IAM
  users.
thumbnail: /content/blog/how-permissions-work-in-aws-lambda-dr/E_AWS-permissions_1200x600.png
author: adamculp
published: true
published_at: 2020-03-25T13:03:43.000Z
updated_at: 2021-05-18T13:11:52.148Z
category: tutorial
tags:
  - php
  - aws
  - lambda
comments: true
redirect: ""
canonical: ""
---
When working with AWS Lambda, many users struggle with permissions using other AWS services. More specifically, how to access services like S3, RDS, Transcribe, or others.

<sign-up number></sign-up>

Many create a new [IAM user](https://aws.amazon.com/iam/), and set `AWS_ACCESS_KEY_ID` and `AWS_SECRET_ACCESS_KEY` in [environment variables](https://docs.aws.amazon.com/sdk-for-php/v3/developer-guide/guide_credentials_environment.html). The AWS SDK "automagically" uses those keys or values from an [AWS Credentials File](https://docs.aws.amazon.com/sdk-for-php/v3/developer-guide/guide_credentials_profiles.html). (See the [documentation](https://docs.aws.amazon.com/sdk-for-php/v3/developer-guide/getting-started_basic-usage.html#creating-a-client) on how the SDK uses those values.) However, adding those credentials for a Lambda would be a mistake.

## Mistaken Identity

Attempting the following `.env` file prevents an application from accessing AWS services from within Lambda. Connection failure is regardless of how you configured the IAM user.

```dotenv
AWS_ACCESS_KEY_ID={{YOUR-ACCESS-KEY-HERE}}
AWS_SECRET_ACCESS_KEY={{YOUR-SECRET-HERE}}
```

As the Lambda function deploys, the environment variables shown above get generated by Lambda. Meaning, the values of the file `.env` do not get set as expected.

To read more about deploying with Serverless, check out [AWS Lambda With PHP Using Bref and Serverless Framework](https://learn.vonage.com/blog/2020/03/16/aws-lambda-with-php-using-bref-and-serverless-framework-dr) or [Serverless Python with AWS Lambda](https://learn.vonage.com/blog/2020/03/20/serverless-python-with-aws-lambda-dr).

## Setting Permissions

With environment variables `AWS_ACCESS_KEY_ID` and `AWS_SECRET_ACCESS_KEY` set by Lambda, the role permissions also need set during deployment. All AWS services also get handled directly in the Lambda function instead of an IAM user.

Below is a partial yaml example using the Serverless framework to deploy an AWS Lambda function.

```yaml
provider:
    name: aws
    region: us-east-1
    runtime: provided
    iamRoleStatements:
        - Effect: Allow
          Action:
              - s3:PutObject
              - s3:GetObject
              - s3:DeleteObject
          Resource: 'arn:aws:s3:::bucket-name/*'
        - Effect: Allow
          Action: transcribe:*
          Resource: '*'
```

Note the `iamRoleStatements` block in the example above. In it, the Lambda is granted `s3:PutObject`, `s3:GetObject`, and `s3:DeleteObject` permissions to the resource `bucket-name` and anything in it. Also, the function has access to `transcribe:*` services.

The example above is very similar to how IAM permissions get set in the examples below:

![aws_iam_s3_policy](/content/blog/how-permissions-work-in-aws-lambda/aws_iam_s3_policy.png "AWS IAM S3 Policy Example")

![amazon_iam_transcribe_policy](/content/blog/how-permissions-work-in-aws-lambda/amazon_iam_transcribe_policy.png "AWS IAM Transcribe Policy Example")

## Examining Permissions

Upon successful deployment to AWS Lambda, the active permissions of the function can be viewed in the AWS Console. Do this by navigating to the Permissions tab of the function console.

![lambda_function_permissions](/content/blog/how-permissions-work-in-aws-lambda/lambda_function_permissions.png "AWS Lambda Function Permissions")

From there, you can click into the permissions of each service for a more detailed breakdown of how you set them.

## What Next

Documentation about possible permissions to various AWS services are available in the [AWS Identity and Access Management Documentation](https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html). Also, watch for future posts with examples of using these permissions in action.